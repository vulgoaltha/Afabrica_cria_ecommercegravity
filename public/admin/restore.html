<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Restaurar Produtos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
        "imports": {
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
        }
    }
    </script>
</head>

<body class="bg-gray-900 text-white h-screen flex flex-col items-center justify-center">
    <div class="text-center space-y-6">
        <h1 class="text-4xl font-bold text-yellow-500">Restaurar Banco de Dados</h1>
        <p class="text-gray-400 max-w-md mx-auto">Clique abaixo para recriar os 6 produtos originais + 80 produtos de
            exemplo no seu banco de dados.</p>

        <button id="btnRestore"
            class="bg-green-600 hover:bg-green-500 text-white font-bold py-4 px-8 rounded-xl text-xl shadow-lg transition-all transform hover:scale-105">
            RESTAURAR TUDO AGORA
        </button>

        <div id="status" class="mt-4 text-sm text-gray-500 font-mono hidden"></div>
    </div>

    <script type="module">
        import { supabase } from '../js/supabase.js';

        const ORIGINAL_PRODUCTS = [
            { title: "Camiseta", description: "Camiseta de alta qualidade com personalização.", price_in_cents: 8990, image: "/img/products/chave.png", category: "cria-do-morro", customizable: true, stock: 50, sizes: ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'] },
            { title: "Calção Esportivo", description: "Calção leve e resistente.", price_in_cents: 5990, image: "/img/products/cavadinha.png", category: "cria-do-morro", customizable: true, stock: 50, sizes: ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'] },
            { title: "Short Passeio", description: "Conforto e lazer.", price_in_cents: 2990, image: "/img/products/passeio.png", category: "cria-do-morro", customizable: false, stock: 50, sizes: ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'] },
            { title: "Boné Trucker", description: "Boné estilo trucker.", price_in_cents: 4990, image: "/img/products/Boné 3.png", category: "bones", customizable: true, stock: 50, sizes: ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'] },
            { title: "Jaqueta Corta-Vento", description: "Leve e impermeável.", price_in_cents: 18990, image: "/img/products/kebrada com manga.png", category: "personalizados", customizable: true, stock: 20, sizes: ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'] },
            { title: "Polo Casual", description: "Clássica e moderna.", price_in_cents: 7990, image: "/img/products/malako.png", category: "cria-do-morro", customizable: true, stock: 50, sizes: ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'] }
        ];

        const BTN = document.getElementById('btnRestore');
        const STATUS = document.getElementById('status');

        BTN.addEventListener('click', async () => {
            BTN.disabled = true;
            BTN.innerText = "Restaurando...";
            STATUS.classList.remove('hidden');
            STATUS.innerText = "Iniciando restauração no Supabase...";

            try {
                // 1. Restore Original
                for (const p of ORIGINAL_PRODUCTS) {
                    const { error } = await supabase
                        .from('products')
                        .insert([p]);

                    if (error) throw error;
                    STATUS.innerText += `\n+ ${p.title}`;
                }

                // 2. Create 80 Random
                const categories = ['cria-do-morro', 'bones', 'bucket', 'personalizados'];
                for (let i = 1; i <= 160; i++) {
                    const category = categories[Math.floor((i - 1) / 40)];
                    const isCria = category === 'cria-do-morro';
                    randomProducts.push({
                        title: `${category.replace(/-/g, ' ').toUpperCase()} #${i}`,
                        description: "Descrição automática para este produto exclusivo.",
                        price_in_cents: Math.floor(Math.random() * 20000) + 5000,
                        image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800&q=80",
                        category: category,
                        sizes: isCria ? ['U'] : ['P', 'M', 'G', 'GG', 'EXG', 'ESP', 'ESP1', 'ESP2'],
                        customizable: !isCria,
                        subtitle: isCria ? 'Tamanho Único' : 'Lançamento 2024',
                        stock: 100
                    });
                }

                // Batch insert for better performance
                const { error: batchError } = await supabase
                    .from('products')
                    .insert(randomProducts);

                if (batchError) throw batchError;

                STATUS.innerText += "\n\nSUCESSO! TUDO PRONTO.";
                BTN.innerText = "CONCLUÍDO!";
                BTN.classList.replace('bg-green-600', 'bg-blue-600');

                setTimeout(() => {
                    const isVite = window.location.port === '3000' || window.location.hostname === 'localhost';
                    window.location.href = isVite ? "/" : "/";
                }, 2000);

            } catch (e) {
                console.error(e);
                STATUS.innerText = "ERRO: " + e.message;
                BTN.disabled = false;
                BTN.innerText = "Tentar Novamente";
            }
        });
    </script>
</body>

</html>